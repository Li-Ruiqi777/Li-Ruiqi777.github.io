<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>04 总线协议 | 李瑞琦的博客</title><meta name="author" content="Li Ruiqi"><meta name="copyright" content="Li Ruiqi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="referrer" content="no-referrer"><meta name="description" content="总线协议对比UART总线概述定义：  UART(Universal Asynchronous Receiver&#x2F;Transmitter)通用异步收发器：异步、串行、全双工通信 USART(Universal Synchronous&#x2F;Asynchronous Receiver&#x2F;Transmitter)通用同步&#x2F;异步收发器：同步或者异步、串行、全双工通信 异步时">
<meta property="og:type" content="article">
<meta property="og:title" content="04 总线协议">
<meta property="og:url" content="https://li-ruiqi777.github.io/01-%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%85%AB%E8%82%A1/04-%E6%80%BB%E7%BA%BF%E5%8D%8F%E8%AE%AE.html">
<meta property="og:site_name" content="李瑞琦的博客">
<meta property="og:description" content="总线协议对比UART总线概述定义：  UART(Universal Asynchronous Receiver&#x2F;Transmitter)通用异步收发器：异步、串行、全双工通信 USART(Universal Synchronous&#x2F;Asynchronous Receiver&#x2F;Transmitter)通用同步&#x2F;异步收发器：同步或者异步、串行、全双工通信 异步时">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://li-ruiqi777.github.io/img/head.png">
<meta property="article:published_time" content="2025-06-04T08:29:12.402Z">
<meta property="article:modified_time" content="2025-09-26T01:25:14.725Z">
<meta property="article:author" content="Li Ruiqi">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://li-ruiqi777.github.io/img/head.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://li-ruiqi777.github.io/01-%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%85%AB%E8%82%A1/04-%E6%80%BB%E7%BA%BF%E5%8D%8F%E8%AE%AE.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '04 总线协议',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.7.0/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/jetbrains-mono@4.5.12/index.min.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background: linear-gradient(135deg, #a9d6e0 0%, #e0f7fa 100%);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/head.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">157</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">19</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">李瑞琦的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">04 总线协议</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">04 总线协议</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-06-04T08:29:12.402Z" title="Created 2025-06-04 16:29:12">2025-06-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-09-26T01:25:14.725Z" title="Updated 2025-09-26 09:25:14">2025-09-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/01-%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%85%AB%E8%82%A1/">01-计算机基础八股</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="总线协议"><a href="#总线协议" class="headerlink" title="总线协议"></a>总线协议</h1><h2 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h2><h2 id="UART总线"><a href="#UART总线" class="headerlink" title="UART总线"></a>UART总线</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>定义：</p>
<ul>
<li>UART(Universal Asynchronous Receiver&#x2F;Transmitter)通用异步收发器：异步、串行、全双工通信</li>
<li>USART(Universal Synchronous&#x2F;Asynchronous Receiver&#x2F;Transmitter)通用同步&#x2F;异步收发器：同步或者异步、串行、全双工通信<ul>
<li>异步时靠波特率进行数据同步</li>
<li>同步时需要额外的CLK线</li>
</ul>
</li>
</ul>
<blockquote>
<p>UART和USART不是总线，是点对点通信</p>
</blockquote>
<p>特点：</p>
<ul>
<li>点对点通信</li>
<li>传输距离较远(可达几十米)</li>
<li>硬件简单，成本低</li>
</ul>
<h3 id="硬件结构"><a href="#硬件结构" class="headerlink" title="硬件结构"></a>硬件结构</h3><table>
<thead>
<tr>
<th align="left">信号线</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">TX</td>
<td align="left">发送数据线</td>
</tr>
<tr>
<td align="left">RX</td>
<td align="left">接收数据线</td>
</tr>
<tr>
<td align="left">GND</td>
<td align="left">共地线</td>
</tr>
</tbody></table>
<ul>
<li>UART原始输出是TTL电平，可通过PHY芯片转成别的电平，比如RS232、RS485、USB</li>
</ul>
<h3 id="通信时序"><a href="#通信时序" class="headerlink" title="通信时序"></a>通信时序</h3><h4 id="数据帧格式"><a href="#数据帧格式" class="headerlink" title="数据帧格式"></a>数据帧格式</h4><ul>
<li><p>起始位：1位低电平</p>
</li>
<li><p>数据位：5-9位(通常8位)</p>
</li>
<li><p>校验位：可选(奇校验&#x2F;偶校验&#x2F;无校验)</p>
</li>
<li><p>停止位：1-2位高电平</p>
</li>
</ul>
<h4 id="波特率"><a href="#波特率" class="headerlink" title="波特率"></a>波特率</h4><ul>
<li>双方必须约定相同的波特率(如9600, 115200等)</li>
<li>波特率误差需控制在允许范围内(通常≤3%)</li>
</ul>
<h4 id="数据流控制"><a href="#数据流控制" class="headerlink" title="数据流控制"></a>数据流控制</h4><ul>
<li><p>无流控：简单通信</p>
</li>
<li><p>硬件流控：使用RTS&#x2F;CTS信号线</p>
</li>
<li><p>软件流控：使用XON&#x2F;XOFF控制字符</p>
</li>
</ul>
<h3 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h3><ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=Mzg3Mjg2NDQ0NA==&mid=2247486103&idx=1&sn=f0b9edddeec6796d33d27770f1a1bfd9&chksm=cee98544f99e0c5213516de4e76c057c6ae934f025de99242e53d57e11621c0cb968055a7ed3&cur_album_id=2969391775742345217&scene=189#wechat_redirect">Linux驱动八股文——UART协议原理篇</a></li>
</ul>
<p>1.串行通信和并行通信的区别</p>
<table>
<thead>
<tr>
<th align="center">特性</th>
<th align="center">串行通信</th>
<th align="center">并行通信</th>
</tr>
</thead>
<tbody><tr>
<td align="center">数据传输方式</td>
<td align="center">数据按位依次传输（单条线路）</td>
<td align="center">数据多位同时传输（多条线路）</td>
</tr>
<tr>
<td align="center">线路复杂度</td>
<td align="center">简单（线路少，成本低）</td>
<td align="center">复杂（线路多，成本高）</td>
</tr>
<tr>
<td align="center">抗干扰能力</td>
<td align="center">较强（时序控制严格）</td>
<td align="center">较弱（多线路同步难，易受干扰）</td>
</tr>
<tr>
<td align="center">传输距离</td>
<td align="center">较远（如USB、以太网）</td>
<td align="center">较短（如打印机电缆）</td>
</tr>
<tr>
<td align="center">速度</td>
<td align="center">现代高速串行（如PCIe）可超越并行</td>
<td align="center">传统并行更快，但高频时同步困难</td>
</tr>
<tr>
<td align="center">典型应用</td>
<td align="center">USB、RS-232、SATA、网络通信</td>
<td align="center">旧式打印机、IDE硬盘接口、PCI总线</td>
</tr>
</tbody></table>
<p>2.串行通信如何保证数据同步</p>
<p>（1）同步串行通信</p>
<ul>
<li>时钟信号同步：<ul>
<li>发送方和接收方共享同一时钟（如SPI、I2C），或通过编码将时钟嵌入数据（如曼彻斯特编码）</li>
<li>例如：SPI协议通过SCLK信号同步每一位数据</li>
</ul>
</li>
<li>数据帧结构：<ul>
<li>使用起始位、停止位、同步字符（如UART的<code>0x55</code>）标识数据边界</li>
<li>例如：I2C协议以起始条件（Start Condition）和停止条件（Stop Condition）标记帧的起止</li>
</ul>
</li>
</ul>
<p>（2）异步串行通信</p>
<ul>
<li>波特率匹配：<ul>
<li>双方约定相同的波特率（如9600bps），通过定时器采样数据位</li>
<li>误差需控制在允许范围内（通常≤3%）</li>
</ul>
</li>
<li>起始&#x2F;停止位：<ul>
<li>每个字节以起始位（低电平）开始，停止位（高电平）结束，重新同步时序</li>
<li>例如：UART协议中，接收方检测到起始位后，在数据位中点采样</li>
</ul>
</li>
</ul>
<p>（3）高级同步技术</p>
<ul>
<li><p>差分信号（如RS-485、USB）：</p>
<ul>
<li>通过双绞线传输反向信号，抑制共模干扰，提升同步稳定性</li>
</ul>
</li>
<li><p>时钟恢复技术（如PCIe、SATA）：</p>
<ul>
<li>接收端从数据流中提取时钟（CDR, Clock Data Recovery），消除时钟偏移问题</li>
</ul>
</li>
<li><p>协议层校验：</p>
<ul>
<li>使用CRC校验或重传机制（如TCP）确保数据完整性</li>
</ul>
</li>
</ul>
<p>2.UART与IIC、SPI的区别是什么</p>
<ul>
<li>UART是异步的，靠波特率同步而不是时钟线</li>
<li>UART是点对点通信，而后2者是总线</li>
</ul>
<p>3.串口结合DMA，如何实现不定长的数据接收</p>
<ul>
<li>利用IDLE中断：串口外设在一帧数据传输完毕后，如果在规定时间内没有新的字节到来，就会产生IDLE中断，在其中读取DMA计数器来获得传输了多少字节</li>
</ul>
<p>4.UART通信中常见问题及解决方案</p>
<table>
<thead>
<tr>
<th align="left">问题</th>
<th align="left">可能原因</th>
<th align="left">解决方案</th>
</tr>
</thead>
<tbody><tr>
<td align="left">数据错误</td>
<td align="left">波特率不匹配</td>
<td align="left">检查双方波特率设置</td>
</tr>
<tr>
<td align="left">只能单方向通信</td>
<td align="left">线路接反或损坏</td>
<td align="left">检查TX&#x2F;RX交叉连接</td>
</tr>
<tr>
<td align="left">长距离通信不稳定</td>
<td align="left">信号衰减</td>
<td align="left">改用RS485差分信号</td>
</tr>
<tr>
<td align="left">高波特率通信失败</td>
<td align="left">时钟精度不足</td>
<td align="left">使用更高精度晶振</td>
</tr>
<tr>
<td align="left">多字节丢失</td>
<td align="left">缓冲区溢出</td>
<td align="left">启用硬件流控或减小发送间隔</td>
</tr>
</tbody></table>
<p>5.UART有哪些校验方式</p>
<ul>
<li><p>奇校验：数据中1的个数+校验位&#x3D;奇数</p>
</li>
<li><p>偶校验：数据中1的个数+校验位&#x3D;偶数</p>
</li>
</ul>
<ol start="6">
<li>UART的硬件流控如何工作</li>
</ol>
<ul>
<li><p>RTS(Request To Send)：发送方准备好发送数据时拉低</p>
</li>
<li><p>CTS(Clear To Send)：接收方准备好接收数据时拉低</p>
</li>
<li><p>工作流程：</p>
<p>1.发送方检查CTS，若为低则开始发送</p>
<p>2.接收方缓冲区快满时拉高CTS阻止发送</p>
<p>3.发送方检测到CTS变高后暂停发送</p>
</li>
</ul>
<p>7.常见电平标准</p>
<table>
<thead>
<tr>
<th align="left">标准</th>
<th align="left">电平定义</th>
<th align="left">传输距离</th>
<th align="left">拓扑结构</th>
<th align="left">典型应用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">TTL</td>
<td align="left">0V&#x3D;0, 3.3V&#x2F;5V&#x3D;1</td>
<td align="left">&lt;1m</td>
<td align="left">点对点</td>
<td align="left">板内芯片间通信</td>
</tr>
<tr>
<td align="left">RS-232</td>
<td align="left">±3V~±15V(负逻辑)</td>
<td align="left">15m</td>
<td align="left">点对点</td>
<td align="left">电脑串口、老式设备</td>
</tr>
<tr>
<td align="left">RS-485</td>
<td align="left">±1.5V~±5V(差分)</td>
<td align="left">1200m</td>
<td align="left">多点总线</td>
<td align="left">工业现场总线</td>
</tr>
<tr>
<td align="left">USB</td>
<td align="left">差分信号(D+&#x2F;D-)</td>
<td align="left">5m</td>
<td align="left">树形拓扑</td>
<td align="left">外设连接</td>
</tr>
</tbody></table>
<h2 id="I2C总线"><a href="#I2C总线" class="headerlink" title="I2C总线"></a>I2C总线</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><ul>
<li>定义：I2C是一个用于短距离数据传输的低速、串行、同步总线，支持半双工通信</li>
<li>通信速度：包括4种通信速度<ul>
<li>Standard Mode：100K bit&#x2F;s</li>
<li>Fast Mode：400K bit&#x2F;s</li>
<li>Fast Mode+：1M bit&#x2F;s</li>
<li>High-Speed Mode：3.4M bit&#x2F;s</li>
</ul>
</li>
</ul>
<h3 id="硬件结构-1"><a href="#硬件结构-1" class="headerlink" title="硬件结构"></a>硬件结构</h3><p><img src="../assets/image-20250414114624643.png" alt="image-20250414114624643"></p>
<ul>
<li>I2C包含SCL、SDA2根线，它是一种<strong>多主多从</strong>的总线架构，2根线上可以挂多个设备</li>
<li>控制器连接I2C总线的GPIO必须设置为<strong>开漏</strong>模式，以支持&#x3D;&#x3D;线与&#x3D;&#x3D;功能，并且需要外部上拉<ul>
<li>线与：只有所有GPIO都是高电平的时候，该总线才是高电平，只要有一个GPIO为低电平，整个总线就被拉低</li>
</ul>
</li>
</ul>
<p><img src="../assets/image-20250414114859764.png" alt="image-20250414114859764"></p>
<p>开漏输出示意图：</p>
<ul>
<li>mos管导通时，输出低电平</li>
<li>mos管断开时，输出电平不确定，由外部电路决定</li>
</ul>
<h3 id="通信时序-1"><a href="#通信时序-1" class="headerlink" title="通信时序"></a>通信时序</h3><blockquote>
<p>在分析I2C总线的具体时序之前，我们得先知道它有哪些<strong>具体操作</strong>，只有这样我们才能知道分析的时序是干啥的</p>
</blockquote>
<h4 id="起始和结束"><a href="#起始和结束" class="headerlink" title="起始和结束"></a>起始和结束</h4><p>由于有上拉电阻在空闲情况下，SCL和SDA都一直是高电平，发生以下时序时意味着开始&#x2F;结束通信：</p>
<ul>
<li>开始通信：SCL高电平时，SDA由高变低</li>
<li>结束通信：SCL高电平时，SDA由低变高</li>
</ul>
<p><img src="../assets/image-20250414194150518.png" alt="image-20250414194150518"></p>
<h4 id="总线响应"><a href="#总线响应" class="headerlink" title="总线响应"></a>总线响应</h4><p>每次传输完一个字节后，从设备必须进行一个回应，回应是ACK或者NACK信号</p>
<p><img src="../assets/image-20250414194523456.png" alt="image-20250414194523456"></p>
<ul>
<li>ACK：传输完8bit后，在第9个bit，SCL高电平时，如果SDA是低电平，则回应的是ACK</li>
<li>NACK：传输完8bit后，在第9个bit，SCL高电平时，如果SDA是高电平，则回应的是NACK</li>
</ul>
<p>spec规定以下几种情况会出现NACK：</p>
<ul>
<li>主机发送到总线上的地址，却没有匹配的从机，因此出现NACK</li>
<li>从机处于 busy 状态，出现 NACK</li>
<li>在传输过程中，从机获取其不理解的数据或命令</li>
<li>在传输过程中，从机无法再接收任何数据字节</li>
<li>主接收机必须向从发射机发送传输结束的信号的时候，会出现NACK</li>
<li>HS mode 的 master code 是 NACK</li>
</ul>
<h4 id="写数据"><a href="#写数据" class="headerlink" title="写数据"></a>写数据</h4><ul>
<li>I2C通信时，&#x3D;&#x3D;数据的传输是以字节为单位的&#x3D;&#x3D;（大端序），起始时是7 bit的地址+1bit的读&#x2F;写位</li>
<li>在每次传输一个字节后，<strong>从机</strong>都应该回答一个ACK</li>
<li>在传完最后一个字节时，正常情况下从机也会回复一个ACK，然后主机发送一个STOP信号。如果从机回复一个NACK，主机也会发送STOP信号，并上报一个ACK error</li>
</ul>
<p><img src="../assets/image-20250414195310345.png" alt="image-20250414195310345"></p>
<h4 id="读数据"><a href="#读数据" class="headerlink" title="读数据"></a>读数据</h4><ul>
<li>主机从slave端读数据时，每读一个字节，<strong>主机端</strong>都应该回应ACK，在读完最后一个字节需要停止传输时，主机需要回应一个NACK</li>
</ul>
<p><img src="../assets/image-20250414200001900.png" alt="image-20250414200001900"></p>
<h4 id="复合格式"><a href="#复合格式" class="headerlink" title="复合格式"></a>复合格式</h4><ul>
<li>主机端可以连续对2个地址不同的从机发起通信，且中间不需要STOP信号</li>
</ul>
<p><img src="../assets/image-20250414200218119.png" alt="image-20250414200218119"></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>以 START 条件开始，以 STOP 条件结束</li>
<li>一个 START 后面紧跟着一个 STOP 信号，是非法格式</li>
<li>传输的第一个字节为 7bit 从机地址 + 1bit 读写位</li>
<li>每个总线上的设备都会比较 STRAT 信号后面的 7bit 地址与自己的地址是否匹配</li>
<li>每个 byte(8 bits)后面都会有 ACK 或者 NACK</li>
<li>在 START 信号或者 repeated START 信号后，从机必须重置自己的总线逻辑</li>
<li>主机 master 可以不产生 STOP 信号，而是直接产生一个 repeated START 信号+另外一个设备地址，直接开始访问另外一个设备</li>
</ul>
<h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3><p>1.一个I2C总线上最多能挂多少设备</p>
<ul>
<li>7位地址：理论上最多128个设备(2^7)</li>
<li>10位地址：理论上最多1024个设备(2^10)</li>
</ul>
<p>但是 I2C 协议规定，总线上的电容不可以超过 <code>400pF</code>。管脚都是有输入电容的，PCB 上也会有寄生电容，所以会有一个限制。实际设计中经验值大概是不超过 <strong>8个</strong>器件</p>
<p>2.运行过程中，如果新的IIC设备接入，主机和从机如何交换地址？</p>
<ul>
<li>主机发送广播地址（遍历所有预定义的地址进行扫描），等待应答 </li>
<li>从机监听到自己地址后进行应答</li>
</ul>
<p>3.IIC从机地址配置方式 </p>
<ul>
<li>内部固定地址：某些 I2C 从机设备具有内部固定的从机地址，无法进行配置或更改。在这种情况 下，从机地址是设备制造商预定义的。 </li>
<li>硬件引脚配置：一些 I2C 从机设备具有专用引脚或引脚配置选项，用于设置从机地址。通过使用跳 线帽、电阻、芯片的引脚配置等方式，用户可以将特定的引脚配置为高电平或低电平，从而设置从 机地址。 </li>
<li>寄存器配置：一些 I2C 从机设备允许使用特殊的寄存器配置来设置从机地址。这通常通过主机和从机之间的特殊序列和命令来实现。</li>
</ul>
<h3 id="面试题-1"><a href="#面试题-1" class="headerlink" title="面试题"></a>面试题</h3><ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/P8A0atdQoS31bgtHqys0RQ">Linux驱动八股文——I2C协议原理篇</a></li>
</ul>
<p>1.为什么I2C需要使用上拉电阻？</p>
<ul>
<li>GPIO是开漏输出，需要上拉为总线提供确定的高电平</li>
<li>限制总线电流，避免短路</li>
<li>与总线电容共同决定信号上升时间，影响通信速率</li>
</ul>
<p>2.为什么I2C要求开漏输出？</p>
<ul>
<li>多主机仲裁：多个主机可同时驱动低电平而不损坏电路，冲突时通过”线与”特性仲裁</li>
<li>电平兼容：不同电压的设备可共用总线（上拉至各自VCC）</li>
<li>热插拔安全：避免输出冲突导致短路</li>
</ul>
<p>3.I2C的地址位数是多少？</p>
<p>4.I2C的通信速率有哪些？</p>
<p>5.I2C的基本时序是什么？</p>
<p>6.I2C如何实现多主机通信？</p>
<ol>
<li>时钟同步：多个主机的SCL线与操作，形成统一时钟</li>
<li>仲裁机制：<ul>
<li>各主机同时发送地址&#x2F;数据</li>
<li>当检测到自身输出电平与总线不一致时自动退出发送（开漏输出的”线与”特性）</li>
<li>最终优先级高的主机赢得仲裁</li>
</ul>
</li>
</ol>
<p>7.I2C的时钟拉伸是什么？</p>
<ul>
<li>时钟拉伸（延展）：I2C 主设备始终控制着时钟线 SCL，不论是往设备写还是从设备读。一般情况下，如操作对象是 EEPROM 或者其他简单设备而言，无所谓，但是，如果从设备是处理器，在接到主机命令后要去处理一些运算然后得出结果返回给主机。这个时候可能造成<strong>来不及处理</strong>。怎么办?这时，从设备会主动控制时钟线把它拉低!直到数据准备好之后再释放时钟线，把控制权交还给 MASTER。这也是 I2C 通信系统中，从机唯一能控制总线的时候!关键是很多 I2C 主机<strong>不支持</strong> clock stretching 功能，所以无法和带有 clock stretching 功能的从机通信!所以,各位在选择主机器件之前，必须要注意这一点，不然整个设计方案可能报废，影响很大。</li>
</ul>
<p>8.I2C通信中常见的问题及解决方案？</p>
<table>
<thead>
<tr>
<th align="center">问题</th>
<th align="center">解决方案</th>
</tr>
</thead>
<tbody><tr>
<td align="center">总线死锁</td>
<td align="center">硬件复位&#x2F;SCL时钟脉冲法恢复</td>
</tr>
<tr>
<td align="center">ACK信号丢失</td>
<td align="center">检查地址&#x2F;上拉电阻&#x2F;设备供电</td>
</tr>
<tr>
<td align="center">信号毛刺</td>
<td align="center">降低速率&#x2F;缩短走线&#x2F;加滤波电容</td>
</tr>
<tr>
<td align="center">地址冲突</td>
<td align="center">使用软件可编程地址 或 放到不同总线上</td>
</tr>
<tr>
<td align="center">长距离通信不稳定</td>
<td align="center">改用更低速率&#x2F;使用I2C缓冲器</td>
</tr>
</tbody></table>
<p>9.如何计算I2C总线上拉电阻的合适值？</p>
<ul>
<li><p>上拉电阻过小，电流大，端口低电平 level增大，会发现总线上电平拉不到 0V</p>
</li>
<li><p>上拉电阻过大，上升沿时间增大，方波可能会变成三角波</p>
</li>
<li><p>具体公式请看飞书文档</p>
</li>
</ul>
<p>10.I2C与SPI的对比及选择依据？</p>
<table>
<thead>
<tr>
<th align="center">特性</th>
<th align="center">I2C</th>
<th align="center">SPI</th>
</tr>
</thead>
<tbody><tr>
<td align="center">线路数</td>
<td align="center">2线（SCL+SDA）</td>
<td align="center">4线（SCK+MISO+MOSI+CS）</td>
</tr>
<tr>
<td align="center">速度</td>
<td align="center">≤5Mbps</td>
<td align="center">≥50Mbps（可达100Mbps+）</td>
</tr>
<tr>
<td align="center">寻址方式</td>
<td align="center">软件地址（节省硬件引脚）</td>
<td align="center">硬件片选（需更多引脚）</td>
</tr>
<tr>
<td align="center">拓扑结构</td>
<td align="center">多主多从</td>
<td align="center">单主多从（菊花链可选）</td>
</tr>
<tr>
<td align="center">功耗</td>
<td align="center">较低（开漏结构）</td>
<td align="center">较高（推挽输出）</td>
</tr>
<tr>
<td align="center">复杂度</td>
<td align="center">协议简单</td>
<td align="center">硬件实现简单</td>
</tr>
<tr>
<td align="center">常规用途</td>
<td align="center">命令</td>
<td align="center">数据</td>
</tr>
<tr>
<td align="center">应答</td>
<td align="center">yes</td>
<td align="center">no</td>
</tr>
</tbody></table>
<ul>
<li>选I2C当：设备多&#x2F;引脚受限&#x2F;速度要求低&#x2F;需要热插拔</li>
<li>选SPI当：高速传输&#x2F;实时性强&#x2F;点对点通信</li>
</ul>
<p>其实还有一点很重要的区别，从操作方式的角度来看，虽然SPI和IIC都只管传输字节，不关注数据帧的内容，但是大部分的器件都遵循以下规律：</p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">I2C</th>
<th align="left">SPI</th>
</tr>
</thead>
<tbody><tr>
<td align="left">操作方式</td>
<td align="left">写寄存器地址 + 数据</td>
<td align="left">发命令（Command）+ 参数（Parameter）</td>
</tr>
<tr>
<td align="left">示例</td>
<td align="left"><code>I2C_Write(0x01, 0xFF)</code></td>
<td align="left"><code>SPI_SendCmd(0xB2); SPI_SendData(0x0B);</code></td>
</tr>
<tr>
<td align="left">底层逻辑</td>
<td align="left">类似“内存访问”（地址+数据）</td>
<td align="left">类似“远程调用”（命令+参数）</td>
</tr>
</tbody></table>
<p>11.spi的命令和参数一般都几个字节？iic的寄存器和数据一般都几个字节？这是由协议决定的还是datasheet</p>
<ul>
<li>完全由datasheet决定</li>
<li>大部分的寄存器地址（IIC）和命令（SPI）都是1个字节，数据&#x2F;参数的字节就五花八门了，可能1个字节的命令后面跟了好几个的参数，每个参数还不是1个字节的</li>
</ul>
<p>12.I2C如何保证主从设备通信一致</p>
<ul>
<li>I2C采用了很多机制来保证主从设备通信一致性，包括：<ul>
<li>硬件层同步机制：<ul>
<li>共享时钟</li>
<li>开漏输出+上拉电阻</li>
</ul>
</li>
<li>协议层同步机制：<ul>
<li>起始&#x2F;结束信号</li>
<li>地址匹配</li>
<li>应答机制</li>
<li>数据有效性规则(SDA必须在SCL高电平时稳定)</li>
</ul>
</li>
<li>错误检测与恢复机制：<ul>
<li>总线仲裁机制(通过线与)</li>
<li>超时检测(SCL被长时间拉低,主设备可能会触发复位)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="SPI总线"><a href="#SPI总线" class="headerlink" title="SPI总线"></a>SPI总线</h2><h3 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h3><ul>
<li><p>定义：SPI是一种高速、全双工、同步、一主多从式的串行通信协议，无应答机制</p>
</li>
<li><p>通信速度：几十MHZ甚至上百MHZ，取决于CPU的SPI控制器的时钟以及外设</p>
<ul>
<li><p>低速模式：1~10 Mbps（如传感器）</p>
</li>
<li><p>高速模式：10~100 Mbps（如Flash存储器、显示屏）</p>
</li>
<li><p>实际速率受限于：</p>
<ul>
<li>主从设备支持的最高频率</li>
<li>线路长度和干扰（高频需短距离布线）</li>
</ul>
</li>
<li><p>比如STM32的SPI控制器的最大速率为18MHZ，i.MX6ULL的最大速率为52MHZ，而一些器件比如ICM20608传感器只支持8MHZ</p>
</li>
</ul>
</li>
<li><p>分类：SPI协议根据数据线（MOSI&#x2F;MISO）的使用方式衍生出多种变体，主要包括 Standard SPI、Dual SPI、Quad SPI 和 QPI&#x2F;OPI 等。这些变体通过增加数据线数量或改变通信方式，显著提升了传输效率</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="center">类别</th>
<th align="center">数据线数量</th>
<th align="center">传输位数&#x2F;周期</th>
<th align="center">速率提升</th>
<th align="center">典型应用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Standard</td>
<td align="center">2（MOSI+MISO）</td>
<td align="center">1-bit</td>
<td align="center">基准</td>
<td align="center">低速传感器</td>
</tr>
<tr>
<td align="center">Dual</td>
<td align="center">2（DQ0+DQ1）</td>
<td align="center">2-bit</td>
<td align="center">2×</td>
<td align="center">SPI Flash</td>
</tr>
<tr>
<td align="center">Quad</td>
<td align="center">4（DQ0~DQ3）</td>
<td align="center">4-bit</td>
<td align="center">4×</td>
<td align="center">高速存储器</td>
</tr>
<tr>
<td align="center">QPI</td>
<td align="center">4（指令复用）</td>
<td align="center">4-bit</td>
<td align="center">4×</td>
<td align="center">嵌入式Flash</td>
</tr>
<tr>
<td align="center">OPI</td>
<td align="center">8（DQ0~DQ7）</td>
<td align="center">8-bit</td>
<td align="center">8×</td>
<td align="center">超高速存储（HyperBus）</td>
</tr>
</tbody></table>
<h3 id="硬件结构-2"><a href="#硬件结构-2" class="headerlink" title="硬件结构"></a>硬件结构</h3><p>以Standard SPI为例：</p>
<img src="../assets/image-20250414205103630.png" alt="image-20250414205103630" style="zoom: 67%;" />

<table>
<thead>
<tr>
<th align="center">信号线</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">SCK</td>
<td align="center">主设备提供的时钟信号</td>
</tr>
<tr>
<td align="center">MOSI</td>
<td align="center">主设备输出，从设备输入（数据）</td>
</tr>
<tr>
<td align="center">MISO</td>
<td align="center">从设备输出，主设备输入（数据）</td>
</tr>
<tr>
<td align="center">SS&#x2F;CS</td>
<td align="center">从设备片选（低电平有效）</td>
</tr>
</tbody></table>
<p>拓扑结构：</p>
<ul>
<li>标准模式：每个从设备独立片选</li>
<li>菊花链模式：多个从设备共享片选，数据级联传递</li>
</ul>
<h3 id="工作模式"><a href="#工作模式" class="headerlink" title="工作模式"></a>工作模式</h3><p>SPI 有四种工作模式，通过时钟极性(CPOL)和时钟相位(CPHA)的搭配来得到四种工作模式:</p>
<ul>
<li>CPOL&#x3D;0，串行时钟空闲状态为低电平</li>
<li>CPOL&#x3D;1，串行时钟空闲状态为高电平</li>
<li>CPHA&#x3D;0，串行时钟的奇数跳变沿(上升沿或下降沿)采集数据</li>
<li>CPHA&#x3D;1，串行时钟的偶数跳变沿(上升沿或下降沿)采集数据</li>
</ul>
<p><img src="../assets/image-20250415090425586.png" alt="image-20250415090425586"></p>
<blockquote>
<p>如何确定所使用的工作模式呢？</p>
</blockquote>
<ul>
<li>一般需要看芯片手册，比如对于LSM6DS3TR-C这款IMU，它的芯片手册有这样一段话：</li>
</ul>
<p>SPC is the serial port clock and it is  controlled by the SPI master. <strong>It is stopped high</strong> when CS is high (no transmission). SDI and  SDO are, respectively, the serial port data input and output. Those lines are driven at the  falling edge of SPC and should <strong>be captured at the rising edge</strong> of SPC.</p>
<ul>
<li>CPOL：因为它空闲时停止在高电平，所以CPOL&#x3D;1</li>
<li>CPHA：因为他在第二个跳变沿对数据采样，所以CPHA&#x3D;1</li>
</ul>
<h3 id="通信时序-2"><a href="#通信时序-2" class="headerlink" title="通信时序"></a>通信时序</h3><img src="../assets/image-20250415090624581.png" alt="image-20250415090624581" style="zoom:80%;" />

<h4 id="起始和结束-1"><a href="#起始和结束-1" class="headerlink" title="起始和结束"></a>起始和结束</h4><ul>
<li>开始通信：CS(片选引脚)由高边低</li>
<li>结束通信：CS(片选引脚)由低变高</li>
</ul>
<h4 id="数据读写"><a href="#数据读写" class="headerlink" title="数据读写"></a>数据读写</h4><img src="../assets/image-20250415090928909.png" alt="image-20250415090928909" style="zoom:67%;" />

<p>使用SPI通信时，主机和从机内都会有<strong>移位寄存器</strong>，主机通过向它的移位寄存器中写一个字节来发起一次数据传输，主机通过MOSI线将移位寄存器中的数据发给从机，从机接收到数据后，将它移位寄存器里的旧数据通过MISO发给主机，并将新数据保存到移位寄存器中</p>
<ul>
<li>SPI和IIC一样，数据的传输是以字节为单位的</li>
<li>SPI通信实际上可以看成主机和从机<strong>交换</strong>移位寄存器的数据</li>
<li>如果我们仅需要写&#x2F;读数据，那么主机就可以忽略收到的数据，或者发送个空的数据</li>
</ul>
<p>下面以CPOL&#x3D;1，CPHA&#x3D;1为例，详细看一下通信时序</p>
<p>（1）主机往从机写数据</p>
<p><img src="../assets/image-20250415091503635.png" alt="image-20250415091503635"></p>
<p>主机发送先发送 8bits，第一个 bit 为0代表这次主机是想写数据到从机，AD6~AD0 表示要写的寄存器地址。然后，主机就会一直写下去。在这期间 SD0 一直没用，一直是高阻态，算是一直读到 1</p>
<p>（2）主机向从机读数据</p>
<img src="../assets/image-20250415091548299.png" alt="image-20250415091548299" style="zoom:80%;" />

<p>这种情况下，主机先发送 8 bits，第一位为1代表这次是读，然后 AD6~ AD0 是想要读的寄存器地址，然后 SDO开始返回数据。</p>
<h3 id="面试题-2"><a href="#面试题-2" class="headerlink" title="面试题"></a>面试题</h3><ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/t5_kgwY-MQ-DUMWSyUvpyg">Linux驱动八股文——SPI协议原理篇</a></li>
</ul>
<p>1.如何选择合适的SPI模式？</p>
<ul>
<li>查阅手册：优先遵循从设备规格书要求（如Flash芯片通常指定模式0或3）</li>
<li>信号完整性：高速时选择下降沿采样（模式1&#x2F;3）可减少时钟抖动影响。</li>
<li>兼容性：通用传感器常用模式0，Flash常用模式3</li>
</ul>
<p>2.描述SPI的基本时序</p>
<ol>
<li>片选激活：主机拉低目标从机的SS信号</li>
<li>时钟同步：主机生成SCK，数据在时钟边沿被采样：<ul>
<li>发送：主机在MOSI输出数据位（MSB&#x2F;LSB优先可配置）</li>
<li>接收：从机在MISO返回数据（全双工下同时进行）</li>
</ul>
</li>
<li>片选释放：通信完成后拉高SS</li>
</ol>
<p>3.SPI通信中数据是如何传输的？</p>
<ul>
<li>位传输：每个SCK周期传输1位数据（Standard SPI），Dual&#x2F;Quad SPI可传输多比特</li>
<li>帧结构：无固定协议，通常为裸字节流，可自己封装个协议（需主从约定）</li>
</ul>
<p>4.如何实现多从设备的SPI通信？</p>
<ul>
<li>独立片选法（常用）：每个从机独占一条SS线，主机分时激活不同SS<ul>
<li>优点：逻辑简单</li>
<li>缺点：引脚占用多（N+3线）</li>
</ul>
</li>
<li>菊花链法：所有从机共享SS，数据级联传递（如74HC595）<ul>
<li>优点：节省引脚</li>
<li>缺点：延迟累积，需特殊硬件支持</li>
</ul>
</li>
</ul>
<p>5.影响SPI通信速度的因素有哪些？</p>
<ul>
<li>硬件限制：主从设备支持的最高SCK频率</li>
<li>信号质量：长走线或干扰会导致时序偏移</li>
<li>软件开销：CPU中断处理或软件模拟SPI的延迟</li>
</ul>
<p>6.如何提高SPI通信的效率？</p>
<ul>
<li>硬件加速：使用DMA传输（如STM32的SPI+DMA）</li>
<li>增大帧长：减少片选切换次数（如32位数据帧替代8位）</li>
<li>时钟优化：选择更高SCK频率（需满足设备时序要求）</li>
</ul>
<p>7.SPI通信中常见的问题及解决方法？</p>
<table>
<thead>
<tr>
<th align="center">问题</th>
<th align="center">解决方法</th>
</tr>
</thead>
<tbody><tr>
<td align="center">数据错误</td>
<td align="center">检查CPOL&#x2F;CPHA模式匹配，缩短走线</td>
</tr>
<tr>
<td align="center">从机无响应</td>
<td align="center">确认SS信号有效，检查电源和复位电路</td>
</tr>
<tr>
<td align="center">信号干扰</td>
<td align="center">增加滤波电容，使用屏蔽线</td>
</tr>
<tr>
<td align="center">速率不稳定</td>
<td align="center">降低SCK频率，检查时钟源稳定性</td>
</tr>
</tbody></table>
<p>8.在实际项目中，如何选择SPI的时钟频率？</p>
<ul>
<li>保守策略：初始设置为从机标称最大频率的50%（如Flash标称80MHz则先用40MHz）</li>
<li>动态调整：逐步提高频率，通过CRC或回读验证数据正确性</li>
</ul>
<p>9.如何处理不同SPI设备的模式差异？</p>
<ul>
<li>软件配置：动态切换主设备的CPOL&#x2F;CPHA</li>
<li>硬件隔离：为不同模式设备分配独立SPI控制器</li>
</ul>
<p>10.如何编写可靠的SPI驱动程序？</p>
<ul>
<li>加入超时机制和CRC校验</li>
</ul>
<p>11.如何调试SPI通信问题？</p>
<ul>
<li>逻辑分析仪：抓取SCK&#x2F;MOSI&#x2F;MISO信号，验证时序和模式</li>
<li>寄存器检查：确认SPI控制器的CR1&#x2F;CR2配置（如BR[2:0]分频位）</li>
<li>环路测试：短接MOSI和MISO，验证主机自发自收</li>
</ul>
<p>12.在嵌入式RTOS环境中，如何管理SPI资源？</p>
<ul>
<li>互斥锁：防止多任务竞争SPI总线（如FreeRTOS的<code>xSemaphoreTake</code>）</li>
<li>信号量：同步DMA传输完成事件（如<code>xSemaphoreGiveFromISR</code>）</li>
<li>优先级控制：高优先级任务抢占SPI总线需谨慎（避免低优先级任务饿死）</li>
</ul>
<h2 id="CAN总线"><a href="#CAN总线" class="headerlink" title="CAN总线"></a>CAN总线</h2><h2 id="硬件结构-3"><a href="#硬件结构-3" class="headerlink" title="硬件结构"></a>硬件结构</h2><h3 id="RS232"><a href="#RS232" class="headerlink" title="RS232"></a>RS232</h3><h3 id="RS485"><a href="#RS485" class="headerlink" title="RS485"></a>RS485</h3></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://Li-Ruiqi777.github.io">Li Ruiqi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://li-ruiqi777.github.io/01-%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%85%AB%E8%82%A1/04-%E6%80%BB%E7%BA%BF%E5%8D%8F%E8%AE%AE.html">https://li-ruiqi777.github.io/01-%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%85%AB%E8%82%A1/04-%E6%80%BB%E7%BA%BF%E5%8D%8F%E8%AE%AE.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/head.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/01-%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%85%AB%E8%82%A1/01-%E7%BC%96%E8%AF%91%E4%B8%8E%E8%B0%83%E8%AF%95.html" title="01 编译与调试"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">01 编译与调试</div></div><div class="info-2"><div class="info-item-1">编译与调试编译的流程将一个.c程序编译成一个可执行文件通常包含4步：  预处理：将各种宏定义翻译成C&#x2F;C++语言 编译：将C&#x2F;C++代码编译成汇编语言 汇编：对汇编代码进行处理，翻译成机器指令 链接：将用到的库文件和自己的机器指令汇总到一起（合并不同文件的同类内容，如.text节区）       从上图可以知道，只要加了-g其实就可以调试代码了，不一定非要使用debug模式编译才行  动态&#x2F;静态链接内部&#x2F;外部链接ELF文件定义：ELF（Excutable Linkable Format）是一种Unix-Like系统上二进制文件的标准，符合ELF标准的ELF文件可以分为4类：    不是所有Linux下的二进制文件都是ELF文件，必须符合一定的格式才行！  ELF文件都遵循以下的格式：     ELF 文件的作用有两个，一是用于程序链接（为了生成程序）；二是用于程序执行。 针对这两种情况，可以从不同的视角来看待同一个目标文件。当它分别被用于链接和用于执行的时候，其特性必然是不一样的，我们所关注的内容也不一样。从链接和运行的角度，可以将...</div></div></div></a><a class="pagination-related" href="/01-%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%85%AB%E8%82%A1/05-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.html" title="05 计算机网络"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">05 计算机网络</div></div><div class="info-2"><div class="info-item-1">计算机网络网络体系结构对于网络体系结构的划分，主要有2种形式： OSI七层网络模型 看赛博二哈的八股（第115条）  OSI（Open Systems Interconnection）模型由ISO提出，是一个理论分层框架，用于标准化网络通信过程。虽然实际网络并未完全采用OSI，但它对理解网络协议分层至关重要    层数 名称 功能 协议&#x2F;设备示例 关键词    7 应用层 提供用户接口，实现具体应用功能（如文件传输、邮件收发） HTTP、FTP、SMTP、DNS    6 表示层 数据格式转换（加密、压缩、编码） SSL&#x2F;TLS、JPEG、ASCII    5 会话层 建立、管理、终止应用程序间的会话 NetBIOS、RPC    4 传输层 提供端到端的数据传输（流量控制、错误恢复） TCP、UDP 端口号、TCP、 UDP   3 网络层 实现主机间的逻辑寻址和路由选择，跨越不同网络 IP、ICMP、路由器 IP地址、路由 器、ping通   2 数据链路层 将比特流封装成数据帧（使用MAC地址在网卡间通信） ARP、网卡、交换机、...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/head.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Li Ruiqi</div><div class="author-info-description">总有低谷</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">157</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">19</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Li-Ruiqi777"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Li-Ruiqi777" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:1009962019@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BA%BF%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.</span> <span class="toc-text">总线协议</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94"><span class="toc-number">1.1.</span> <span class="toc-text">对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UART%E6%80%BB%E7%BA%BF"><span class="toc-number">1.2.</span> <span class="toc-text">UART总线</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.2.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.2.</span> <span class="toc-text">硬件结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E6%97%B6%E5%BA%8F"><span class="toc-number">1.2.3.</span> <span class="toc-text">通信时序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%B8%A7%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">数据帧格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A2%E7%89%B9%E7%8E%87"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">波特率</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%B5%81%E6%8E%A7%E5%88%B6"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">数据流控制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-number">1.2.4.</span> <span class="toc-text">面试题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#I2C%E6%80%BB%E7%BA%BF"><span class="toc-number">1.3.</span> <span class="toc-text">I2C总线</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="toc-number">1.3.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%BB%93%E6%9E%84-1"><span class="toc-number">1.3.2.</span> <span class="toc-text">硬件结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E6%97%B6%E5%BA%8F-1"><span class="toc-number">1.3.3.</span> <span class="toc-text">通信时序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%B7%E5%A7%8B%E5%92%8C%E7%BB%93%E6%9D%9F"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">起始和结束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BA%BF%E5%93%8D%E5%BA%94"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">总线响应</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E6%95%B0%E6%8D%AE"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">写数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E6%95%B0%E6%8D%AE"><span class="toc-number">1.3.3.4.</span> <span class="toc-text">读数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.3.3.5.</span> <span class="toc-text">复合格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.3.3.6.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">1.3.4.</span> <span class="toc-text">常见问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98-1"><span class="toc-number">1.3.5.</span> <span class="toc-text">面试题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SPI%E6%80%BB%E7%BA%BF"><span class="toc-number">1.4.</span> <span class="toc-text">SPI总线</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-2"><span class="toc-number">1.4.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%BB%93%E6%9E%84-2"><span class="toc-number">1.4.2.</span> <span class="toc-text">硬件结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.3.</span> <span class="toc-text">工作模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E6%97%B6%E5%BA%8F-2"><span class="toc-number">1.4.4.</span> <span class="toc-text">通信时序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%B7%E5%A7%8B%E5%92%8C%E7%BB%93%E6%9D%9F-1"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">起始和结束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%86%99"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">数据读写</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98-2"><span class="toc-number">1.4.5.</span> <span class="toc-text">面试题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CAN%E6%80%BB%E7%BA%BF"><span class="toc-number">1.5.</span> <span class="toc-text">CAN总线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%BB%93%E6%9E%84-3"><span class="toc-number">1.6.</span> <span class="toc-text">硬件结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RS232"><span class="toc-number">1.6.1.</span> <span class="toc-text">RS232</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RS485"><span class="toc-number">1.6.2.</span> <span class="toc-text">RS485</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By Li Ruiqi</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">人因梦想而伟大</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>